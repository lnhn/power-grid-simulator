# 化工厂电网模拟系统 - 使用说明

## 快速开始

### 系统要求
- Node.js 18+ 
- npm 或 yarn

### 安装步骤

1. **进入项目目录**
```bash
cd power-grid-simulator
```

2. **安装依赖**
```bash
npm install
```

3. **初始化数据库**
```bash
npx prisma generate
npx prisma db push
```

4. **填充测试数据**
```bash
npx tsx prisma/seed.ts
```

5. **启动开发服务器**
```bash
npm run dev
```

6. **访问应用**
打开浏览器访问：http://localhost:3000

## 登录账号

系统预置了两个测试账号：

### 工程师账号
- **用户名**：engineer
- **密码**：password
- **权限**：
  - ✅ 创建新电网
  - ✅ 编辑电网
  - ✅ 模拟运行
  - ✅ 查看操作日志

### 操作员账号
- **用户名**：operator
- **密码**：password
- **权限**：
  - ❌ 创建新电网
  - ❌ 编辑电网
  - ✅ 模拟运行
  - ✅ 查看操作日志

## 功能详解

### 1. 登录系统

访问系统后会自动跳转到登录页面。输入用户名和密码即可登录。

### 2. 仪表盘（Dashboard）

登录成功后进入仪表盘，可以看到：
- 所有已创建的电网列表
- 每个电网的基本信息
- "模拟运行"和"编辑"按钮（根据权限显示）

**工程师独有功能**：
- 点击右上角"创建电网"按钮新建电网

### 3. 编辑电网（仅工程师）

#### 添加元件
从左侧面板点击对应按钮添加元件：
- **电源**：提供 220V 电压
- **开关**：控制电路通断
- **负载**：消耗电能的设备
- **母线**：电力分配节点

#### 连接元件
1. 将鼠标悬停在节点边缘，会看到连接点
2. 点击并拖拽连接点到另一个节点
3. 释放鼠标完成连接

#### 删除元件/连线
1. 点击选中要删除的元件或连线
2. 按键盘 `Delete` 或 `Backspace` 键

#### 保存
点击右上角"保存"按钮保存所有更改

### 4. 模拟运行

进入模拟模式后：

#### 查看系统状态
左侧面板显示：
- 电源节点数量
- 开关闭合数量
- 带电负载数量

#### 操作开关
- 点击开关节点切换开/关状态
- 绿色边框 = 闭合
- 红色边框 = 断开

#### 观察电路状态
- **蓝色动画线条**：表示有电流流过
- **节点颜色变化**：带电时节点更亮
- **脉冲动画**：表示设备运行中

#### 查看操作日志
点击右上角"操作日志"按钮查看：
- 操作时间
- 操作类型（闭合/断开）
- 操作节点
- 操作人员信息

## 电网设计建议

### 基础电路
```
[电源] → [主开关] → [母线] → [分支开关] → [负载]
```

### 双电源供电
```
[电源1] ↘
          [母线] → [负载]
[电源2] ↗
```

### 多负载分配
```
                  ↗ [开关1] → [负载1]
[电源] → [母线] → [开关2] → [负载2]
                  ↘ [开关3] → [负载3]
```

## 常见问题

### Q: 为什么我看不到"创建电网"按钮？
A: 只有工程师角色才能创建电网。请使用 engineer 账号登录。

### Q: 为什么我无法编辑电网？
A: 操作员角色只能查看和模拟，不能编辑。请使用 engineer 账号。

### Q: 如何删除电网？
A: 目前版本暂不支持删除电网。后续版本会添加此功能。

### Q: 操作日志保存在哪里？
A: 所有操作日志保存在 SQLite 数据库中，可以在操作日志面板查看。

### Q: 可以同时模拟多个电网吗？
A: 可以。每个电网都是独立的，可以在不同标签页中打开。

### Q: 电路计算准确吗？
A: 当前版本使用简化的电路模型。主要用于演示和培训，不能作为工程计算依据。

## 技术支持

如有问题，请查看：
1. README.md - 技术文档
2. 项目源代码注释
3. Next.js 官方文档：https://nextjs.org
4. ReactFlow 文档：https://reactflow.dev

## 安全建议

⚠️ **重要提示**：
- 默认密码仅用于测试
- 生产环境请修改 `.env` 中的 `NEXTAUTH_SECRET`
- 生产环境请为所有用户设置强密码
- 建议使用 PostgreSQL 替代 SQLite

## 更新日志

### v1.0.0 (2024)
- ✨ 初始版本发布
- ✅ 用户认证系统
- ✅ 角色权限管理
- ✅ 电网编辑器
- ✅ 实时模拟功能
- ✅ 操作日志记录
